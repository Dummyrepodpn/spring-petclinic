pipeline {
    agent { label 'JDK_17' }
    triggers { pollSCM('* * * * *') }
    environment {
        SONAR_TOKEN = credentials('SONAR_ID')  // Ensure this credential is added in Jenkins
        SONAR_PROJECT_KEY = 'spring19'
        SONAR_ORGANIZATION = 'spring19'
        MAVEN_TOOL = 'MAVEN' // Your configured Maven tool in Jenkins
    }
    stages{
        stage('vcn') {
            steps {
                git url: 'https://github.com/Dummyrepodpn/spring-petclinic.git',
                    branch: 'main'
            }
        }
        stage('package') {
            tools { 
               jdk 'JDK_17'
            }
            steps {
               sh "mvn package"
            }
        }
        stage('SonarCloud Analysis') {
            steps {
                withSonarQubeEnv('SONAR_CLOUD') {
                    sh "mvn sonar:sonar -Dsonar.projectKey=${env.SONAR_PROJECT_KEY} -Dsonar.organization=${env.SONAR_ORGANIZATION} -Dsonar.host.url=https://sonarcloud.io -Dsonar.login=${env.SONAR_TOKEN}"
                }
            }
        }
    }    
}